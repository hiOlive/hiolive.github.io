<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="TensorFlow," />








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2" />






<meta name="description" content="前面几篇文章尽量用通俗的语言讲了TensorFlow的基本理解、数据总结、深入理解。接下来的将通过一个个实战用例、由浅入深、分门别类、一步步详细介绍曲线模拟、图像识别简单版、图像识别卷积版、AI写诗、图像识别LSTM等。 每篇文章会先分析这些实例实现的深层原理（为什么这样做？这样做的好处是什么？…），像前3篇文章一样，这些都尽量用通俗的语言简化出来。然后放上注释详细可运行的代码，保证写明白代码运行">
<meta name="keywords" content="TensorFlow">
<meta property="og:type" content="article">
<meta property="og:title" content="TensorFlow (五) 曲线拟合">
<meta property="og:url" content="http://iwifigame.com/tensorflow_curve_fitting/index.html">
<meta property="og:site_name" content="爱 wifi 游戏">
<meta property="og:description" content="前面几篇文章尽量用通俗的语言讲了TensorFlow的基本理解、数据总结、深入理解。接下来的将通过一个个实战用例、由浅入深、分门别类、一步步详细介绍曲线模拟、图像识别简单版、图像识别卷积版、AI写诗、图像识别LSTM等。 每篇文章会先分析这些实例实现的深层原理（为什么这样做？这样做的好处是什么？…），像前3篇文章一样，这些都尽量用通俗的语言简化出来。然后放上注释详细可运行的代码，保证写明白代码运行">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://iwifigame.com/tensorflow_curve_fitting/curve_data.png">
<meta property="og:image" content="http://iwifigame.com/tensorflow_curve_fitting/curve_fitting_test.png">
<meta property="og:image" content="http://iwifigame.com/tensorflow_curve_fitting/curve_data.png">
<meta property="og:image" content="http://iwifigame.com/tensorflow_curve_fitting/curve_fitting_1_sigmoid.png">
<meta property="og:image" content="http://iwifigame.com/tensorflow_curve_fitting/curve_data.png">
<meta property="og:image" content="http://iwifigame.com/tensorflow_curve_fitting/cur_fitting_train.gif">
<meta property="og:image" content="http://iwifigame.com/tensorflow_curve_fitting/curve_fitting_test.png">
<meta property="og:updated_time" content="2017-09-28T10:28:10.007Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TensorFlow (五) 曲线拟合">
<meta name="twitter:description" content="前面几篇文章尽量用通俗的语言讲了TensorFlow的基本理解、数据总结、深入理解。接下来的将通过一个个实战用例、由浅入深、分门别类、一步步详细介绍曲线模拟、图像识别简单版、图像识别卷积版、AI写诗、图像识别LSTM等。 每篇文章会先分析这些实例实现的深层原理（为什么这样做？这样做的好处是什么？…），像前3篇文章一样，这些都尽量用通俗的语言简化出来。然后放上注释详细可运行的代码，保证写明白代码运行">
<meta name="twitter:image" content="http://iwifigame.com/tensorflow_curve_fitting/curve_data.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.2',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://iwifigame.com/tensorflow_curve_fitting/"/>





  <title>TensorFlow (五) 曲线拟合 | 爱 wifi 游戏</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?79aef6896eb90dbc14242b196015b9e9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">爱 wifi 游戏</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://iwifigame.com/tensorflow_curve_fitting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="iwifigame">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="爱 wifi 游戏">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">TensorFlow (五) 曲线拟合</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-20T22:27:00+08:00">
                2017-09-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/TensorFlow/" itemprop="url" rel="index">
                    <span itemprop="name">TensorFlow</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/tensorflow_curve_fitting/" class="leancloud_visitors" data-flag-title="TensorFlow (五) 曲线拟合">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>前面几篇文章尽量用通俗的语言讲了TensorFlow的<a href="http://iwifigame.com/tensorflow_basic_understanding/">基本理解</a>、<a href="http://iwifigame.com/tensorflow_data_summary/">数据总结</a>、<a href="http://iwifigame.com/tensorflow_deep_understanding">深入理解</a>。接下来的将通过一个个实战用例、由浅入深、分门别类、一步步详细介绍曲线模拟、图像识别简单版、图像识别卷积版、AI写诗、图像识别LSTM等。</p>
<p>每篇文章会先分析这些实例实现的深层原理（为什么这样做？这样做的好处是什么？…），像前3篇文章一样，这些都尽量用通俗的语言简化出来。然后放上注释详细可运行的代码，保证写明白代码运行机制，且保证每一行代码都经过不断地修改与优化。最后附上代码运行过程展示，尽量使用图片、动态图等方式说明机器一步步学习的过程。</p>
<p>这些文章所使用的TensorFlow版本是目前最新的0.12.0-rc1也就是通常所说的1.2版本，如无必要，以后不再说明使用版本情况。</p>
<p>从前面几篇系列文章，我们知道用机器学习来完成某些事情，比直接通过硬编码来完成，其工作量直接从编码转移到了数据的收集。这大大减少了程序员编码的负担。这种变化就像工业革命一样，解放了人的体力劳动；而人工智能则是解放了脑力劳动。这个革命之后，当人体之外的体力与脑力都被替代了，必由外而向内革命，让人自身变得更强、更聪明、更长寿；同时也向地球之外，不断探索。所以乔布斯遗嘱，让他的后代去从事生物方面的事业，不得不说是远见。现在正是脑力劳动大量被替代的过程。先从机器容易从事的、简单的开始，一步步、全部替代。这是时代发展的必然，这也是我们有生之年可见的未来。</p>
<p>本文以曲线拟合为例子，详细说明基本的函数api、TensorFlow程序的基本结构、数据的直观展示等。这个程序虽然看上去简单，但其充分直观地体现了机器学习的代码结构与过程。</p>
<h2 id="1-曲线拟合原理"><a href="#1-曲线拟合原理" class="headerlink" title="1. 曲线拟合原理"></a>1. 曲线拟合原理</h2><p>给你一条复杂的曲线图，如图1-1，要你设计一种机制，使通过这种机制计算出的点能够尽可能地和这条曲线重合，这个过程就叫曲线拟合。当你面对这样的问题时，我们应该怎么做？<br><img src="/tensorflow_curve_fitting/curve_data.png" alt="1-1"></p>
<p>如果不使用计算机，我们可能是先观察曲线的形式，猜想其形状中应该有哪些数学公式。如在这个例子中，我们可能会猜测公式中有sin相关的成份，然后再加入什么x，x的平方，x的立方。最终通过解方程大概就能求出这个公式来拟合这条曲线了。用这个方法可以解决上面提出的问题。并且当数据超出这些给定的数据范围（x超出-20到20）时，能更好地拟合将来的数据。如图1-1。当数据超出给定训练结果时，如果你计算出的函数正好与原有的曲线函数相对应，则能很好地预测超出的值。</p>
<p>而如果用机器学习的方法，图1-2中的蓝线就是机器学习的结果。从图中可以看出，当测试数据超出训练数据范围（xf超出-20到20）时，结果与测试的结果根本就对不上。其中的原理在前面3篇文章中详细介绍过：这是由于人强于推理，可以很好地解决推理出的未见的事情；而机器现在比较笨，只能根据你给定的训练数值来模拟。测试数据超出训练范围，机器学习就不再知道应该怎么做。当然，可以把未见的测试数据不断地加入训练数据中，然后机器不断地学习新数据（知识），使其适应范围越来越广。这也是为什么人工智能一开始比较笨，而随着你越使用它，它会变得越来越聪明的原因。<br><img src="/tensorflow_curve_fitting/curve_fitting_test.png" alt="1-2"></p>
<p>机器学习，怎么解决这种曲线拟合的问题呢？机器来解决，我们就不能说像上面提到的人类解决的方法一样：直接把公式中有的成分先写出来，然后根据曲线中的数据，计算出相应的参数。因为曲线的形状有无数种，你对这一条曲线用某些数学公式可以拼凑出来，换一条曲线呢？换另外的曲线公式吗？还是把所有的已知的所有数学公式全部放一个式子里，让计算机去计算每个参数，如y=a<em>sin(x)+b</em>x+c<em>x</em>x+d<em>x</em>x<em>x+d</em>x<em>x</em>x…？先不说上面两种方法的可实现性，如果碰到曲线奇里八怪的，根本就不能由数学公式组合出来怎么办。上面的那两种方法显然不行。人来解决这样的问题也够呛。</p>
<p>当然这里，有一种简单统计学的方法，我在训练数据中保存足够的样例数据。然后你给我一个x,我根据这个x去查找x周围，对应的y取值。然后把这些y值，根据距离x的远近，简单加权（离x近的，权重大，远的，权重小），返回给你，曲线拟合完毕。但是这有一个问题，你必须保存大量数据，保证每个区域内都有足够的数据来让你预测出y值。在图1-1中，数据很小，很容易解决。而如果这样的数据分布很大，数据有几个G，几个T，就不能这样做了。</p>
<p>机器解决曲线拟合问题的本质是要设计一种方便且简单可运行的机制，来预测的曲线。曲线中的每个点中的x可以看成元素x，而其y值可以看成结果。机器学习就是要学习元素x到结果y的对应关系。 前面几篇文章讲了，机器学习通过最简单的y=Wx+b来表示属性x到结果y的映射，由于(x,y)形状的千变万化（这里就是曲线形式千变万化），因此，要想让y=Wx+b体现这些变化，必需加入各种非线性的激活函数如sigmoid、tanh等。具体原理请参考系列的前3篇文章。因此，曲线拟合也是这样处理，我们先计算Wx+b,然后通过组合激活函数，来模拟任意形状的曲线。 这种方法，无需参想y=f(x)中有哪些形式和有多少个的各种表达式；也无需保存足够的数据样本，只需要训练出相关参数，保存即可。而且其拟合过程比以上说的方法都更快，更好。其基于Tensorflow的具体代码请看下面的代码详解。</p>
<h2 id="2-代码详解"><a href="#2-代码详解" class="headerlink" title="2. 代码详解"></a>2. 代码详解</h2><h4 id="2-1-数据生成"><a href="#2-1-数据生成" class="headerlink" title="2.1 数据生成"></a>2.1 数据生成</h4><p>我们用y=400<em>np.sin(x)+2</em>x*x+noise来生成要模拟的曲线，其中的noise是随机生成的噪点。生成的训练数据如下图。<br><figure class="highlight rsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># 生成测试数据根据x计算y值</span></div><div class="line">def computeYByX(x):</div><div class="line">    <span class="built_in">noise</span> = np.<span class="built_in">random</span>.<span class="keyword">normal</span>(<span class="number">-100</span>, <span class="number">100</span>, x.shape) <span class="meta"># 以正太分布的形式产生噪点</span></div><div class="line">    <span class="keyword">return</span> <span class="number">400</span> * np.<span class="built_in">sin</span>(x) + <span class="number">2</span> * x * x + <span class="built_in">noise</span></div></pre></td></tr></table></figure></p>
<p><img src="/tensorflow_curve_fitting/curve_data.png" alt=""></p>
<h4 id="2-2-数据表示"><a href="#2-2-数据表示" class="headerlink" title="2.2 数据表示"></a>2.2 数据表示</h4><p>可以用Pylot在直角坐标系上很直观方便地画出曲线(x,y)以及学到的曲线。代码中乃至的Pylot图表的相关介绍，请查看我的<a href="http://iwifigame.com/python_draw_image/">这篇文章</a>。其中用到的最主要代码如下。<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 画点</span></div><div class="line">plt.plot(xTrain[<span class="number">0</span>], yTrain[<span class="number">0</span>], <span class="string">'ro'</span>, label = <span class="string">u'训练数据'</span>)</div><div class="line"><span class="comment"># 画线</span></div><div class="line">plt.plot(xTrain[<span class="number">0</span>], y.eval(&#123;x: xTrain&#125;, sess)[<span class="number">0</span>], label = <span class="string">u'拟合曲线'</span>)</div></pre></td></tr></table></figure></p>
<h4 id="2-3-曲线模拟形式选择"><a href="#2-3-曲线模拟形式选择" class="headerlink" title="2.3 曲线模拟形式选择"></a>2.3 曲线模拟形式选择</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">y</span> = tf.matmul(x, W3) + b3</div></pre></td></tr></table></figure>
<p>看上面的代码，我们用单层的网络。计算线性的x*W3+b3。如果加入非线性的sigmoid激活函数，改变Wx+b的值，改为 y = tf.nn.sigmoid(tf.matmul(x, W3) + b3)等相关形式，理论上应该能更好地模拟曲线。但实际的运行结果要么是直线，要么是各种上下不断交错。然后损失值下降不明显。如下图，是训练1万次之后的结果。我分析，应该是由于W与b的初值选得不好，造成sigmoid的中传入的参数值要么太大，要么太小，从而造成sigmoid值的梯度变化基本为0。因此达不到训练的结果。大家如果有什么更好的解释，可以在下面留言一起讨论。我是觉得用单层网络y = tf.nn.sigmoid(tf.matmul(x, W3) + b3)肯定能很好地模拟曲线的。<br><img src="/tensorflow_curve_fitting/curve_fitting_1_sigmoid.png" alt=""></p>
<p>经过测试，如果直接用y=tf.matmul(x, W3)+b3来做为单层网络，可以比较好的解决曲线拟合问题。但这与我们的目标不符。因此，经过查找与测试研究，终于找到了加入sigmoid激活函数且对各种曲线模拟通用性都比较好曲线模拟办法。通过加入两层网络，如下。<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">def bias_variable(shape):</div><div class="line">  initial = tf.constant(0.1, shape=shape)</div><div class="line">  return tf.Variable(initial)</div><div class="line"></div><div class="line">hiddenDim = 400</div><div class="line"></div><div class="line">W = weight_variable([hiddenDim, 1]) <span class="comment"># W 被初始化为 hiddemDimX1 的符合正态分布的随机矩阵</span></div><div class="line">b = bias_variable([hiddenDim,1])</div><div class="line"></div><div class="line">W2 = weight_variable([1, hiddenDim])</div><div class="line">b2 = bias_variable([1])</div><div class="line"></div><div class="line">hidden = tf.nn.sigmoid(tf.matmul(W, x) + b)</div><div class="line">y = tf.matmul(W2, hidden) + b2</div></pre></td></tr></table></figure></p>
<p>在这种方法中，对W,b的初值选取没有第一种方法那么严格。而且如果模拟的结果不甚理想时，可以简单地加大W与b 中的维度hiddenDim的值，就可得到更好的模拟结果。</p>
<h4 id="2-4-损失与优化"><a href="#2-4-损失与优化" class="headerlink" title="2.4 损失与优化"></a>2.4 损失与优化</h4><p>这里没什么可说的，定义y与训练值yTrain之间差的平方的平均值为损失函数。然后就是选择优化算法，不详细解释。现在就知道它们会通过某些机制，让损失函数值loss越来越小，也就代表曲线越来越重合，直到训练过程完毕。<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="attr">loss</span> = tf.reduce_mean(tf.square(y - yTrain)) # 以y之间的差的平方的均值为损失函数</div><div class="line"><span class="attr">step</span> = tf.Variable(<span class="number">0</span>, trainable=<span class="literal">False</span>)</div><div class="line"><span class="attr">rate</span> = tf.train.exponential_decay(<span class="number">0.15</span>, step, <span class="number">1</span>, <span class="number">0.9999</span>)</div><div class="line"><span class="attr">optimizer</span> = tf.train.AdamOptimizer(rate)</div></pre></td></tr></table></figure></p>
<h4 id="2-5-训练"><a href="#2-5-训练" class="headerlink" title="2.5 训练"></a>2.5 训练</h4><p>用上面定义的损失函数与优化方法定义训练过程。不断地在上一步训练结果的基础上，叠代循环训练了10001次。每次理论上都不断地减少了y与yTrain之间的差距，即曲线拟合得越来越好。<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">train = optimizer.minimize(loss, <span class="attribute">global_step</span>=step)</div><div class="line">init = tf.global_variables_initializer()</div><div class="line"></div><div class="line"><span class="comment"># Launch the graph</span></div><div class="line">sess = tf.Session()</div><div class="line">sess.<span class="builtin-name">run</span>(init)</div><div class="line"></div><div class="line"><span class="keyword">for</span> time <span class="keyword">in</span> range(0, 10001):</div><div class="line">    train.<span class="builtin-name">run</span>(&#123;x: xTrain&#125;, sess)</div></pre></td></tr></table></figure></p>
<h4 id="2-6-测试训练结果"><a href="#2-6-测试训练结果" class="headerlink" title="2.6 测试训练结果"></a>2.6 测试训练结果</h4><p>生成测试数据，用训练出的y表达式，计算出y值。把测试数据与训练计算结果显示在图上。如下，这里用超出训练数据范围的数据作用测试数据，看超出范围时，机器学习的学习成果是否正确。<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">xTest = np.linspace(-<span class="number">40</span>, <span class="number">40</span>, <span class="number">401</span>).reshape([<span class="number">1</span>, -<span class="number">1</span>])</div><div class="line">yTest = computeYByX(xTest)</div><div class="line"></div><div class="line"><span class="comment"># 在坐标图上，显示最终训练的结果</span></div><div class="line">plt.clf()</div><div class="line">plt.plot(xTest[<span class="number">0</span>], yTest[<span class="number">0</span>], <span class="string">'go'</span>, label=<span class="string">u'测试数据'</span>)</div><div class="line">plt.plot(xTest[<span class="number">0</span>], y.eval(&#123;x: xTest&#125;, sess)[<span class="number">0</span>], label = <span class="string">u'拟合曲线'</span>) <span class="comment"># 将训练数据用圆点的形式显示出来</span></div><div class="line">plt.legend()</div><div class="line">plt.savefig(<span class="string">'curve_fitting_test.png'</span>,dpi=<span class="number">200</span>)</div><div class="line">plt.show() <span class="comment"># 将曲线学习结果用图片直观的显示出来</span></div></pre></td></tr></table></figure></p>
<p>这就是曲线模拟的所有过程。所有的机器学习过程基本上是这样：先定义训练数据表示形式；再设计元素x到结果y的映射；然后定义损失函数、选择优化方法；最终训练并验证训练结果。</p>
<p>由于代码太长，详细代码放在本文最后。</p>
<h2 id="3-运行过程与结果"><a href="#3-运行过程与结果" class="headerlink" title="3. 运行过程与结果"></a>3. 运行过程与结果</h2><p>生成的训练数据如下图，x的取值范围由-20到20。<br><img src="/tensorflow_curve_fitting/curve_data.png" alt=""><br>训练过程的动态图如下，可以看到训练出的曲线与训练数据不断拟合。<br><img src="/tensorflow_curve_fitting/cur_fitting_train.gif" alt=""><br>测试结果如下。从图中看出，当测试结果x在训练数据x的范围内时，其曲线拟合结果很好。但当一超出训练数据x的范围（超出-20到20），曲线拟合就完全对不上，变成了直线。<br><img src="/tensorflow_curve_fitting/curve_fitting_test.png" alt=""></p>
<h2 id="4-详细代码"><a href="#4-详细代码" class="headerlink" title="4. 详细代码"></a>4. 详细代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf <span class="comment"># 导入TensorFlow</span></div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np <span class="comment"># 导入多维数组操作库</span></div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt <span class="comment"># 导入画图类库</span></div><div class="line"></div><div class="line"><span class="comment"># plt 设置正常显示中文与负号</span></div><div class="line">plt.rcParams[<span class="string">'font.sans-serif'</span>]=[<span class="string">'SimHei'</span>] <span class="comment">#用来正常显示中文标签</span></div><div class="line">plt.rcParams[<span class="string">'axes.unicode_minus'</span>]=<span class="keyword">False</span> <span class="comment">#用来正常显示中文标签时的负号</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">computeYByX</span><span class="params">(x)</span>:</span></div><div class="line">    noise = np.random.normal(<span class="number">-100</span>, <span class="number">100</span>, x.shape) <span class="comment"># #產生100個平均0, 標準差0.2的干扰值</span></div><div class="line">    <span class="keyword">return</span> <span class="number">400</span> * np.sin(x) + <span class="number">2</span> * x * x + noise</div><div class="line">    <span class="comment">#  return np.sin(x)</span></div><div class="line"></div><div class="line">xTrain = np.linspace(<span class="number">-20</span>, <span class="number">20</span>, <span class="number">401</span>).reshape([<span class="number">1</span>, <span class="number">-1</span>]) <span class="comment"># xTrain为 1x401 数值在-20到20之间平均分布的矩阵</span></div><div class="line">noise = np.random.normal(<span class="number">-0.2</span>, <span class="number">0.2</span>, xTrain.shape) <span class="comment"># #產生100個平均0, 標準差0.2的干扰值</span></div><div class="line">yTrain = computeYByX(xTrain)</div><div class="line"></div><div class="line"><span class="comment"># 保存初始训练数据图片</span></div><div class="line">plt.clf() <span class="comment"># 清空plt画板</span></div><div class="line">plt.plot(xTrain[<span class="number">0</span>], yTrain[<span class="number">0</span>], <span class="string">'ro'</span>, label = <span class="string">u'训练数据'</span>) <span class="comment"># 将训练数据用圆点的形式显示出来</span></div><div class="line">plt.legend()  <span class="comment"># 显示图片中的图例说明。如点代表数据，蓝线代表拟合曲线</span></div><div class="line">plt.savefig(<span class="string">'curve_data.png'</span>,dpi=<span class="number">200</span>) <span class="comment"># 保存图片</span></div><div class="line"></div><div class="line"><span class="comment"># x 被定义为 1xNone 的占位符，None表示可以是任意值，根据喂的数据来定。</span></div><div class="line"><span class="comment"># 这里由于训练时喂的是xTrain,因此None到时被替换为401，也可以写成401</span></div><div class="line">x = tf.placeholder(tf.float32, [<span class="number">1</span>,<span class="number">401</span>])</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">weight_variable</span><span class="params">(shape)</span>:</span></div><div class="line">  initial = tf.truncated_normal(shape, stddev=<span class="number">0.1</span>) <span class="comment"># 从正态分布中得到随机值</span></div><div class="line">  <span class="keyword">return</span> tf.Variable(initial)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">bias_variable</span><span class="params">(shape)</span>:</span></div><div class="line">  initial = tf.constant(<span class="number">0.1</span>, shape=shape)</div><div class="line">  <span class="keyword">return</span> tf.Variable(initial)</div><div class="line"></div><div class="line">hiddenDim = <span class="number">400</span></div><div class="line"></div><div class="line">W = weight_variable([hiddenDim, <span class="number">1</span>]) <span class="comment"># W 被初始化为 hiddemDimX1 的符合正态分布的随机矩阵</span></div><div class="line">b = bias_variable([hiddenDim,<span class="number">1</span>])</div><div class="line"></div><div class="line">W2 = weight_variable([<span class="number">1</span>, hiddenDim])</div><div class="line">b2 = bias_variable([<span class="number">1</span>])</div><div class="line"></div><div class="line">W3 = weight_variable([<span class="number">401</span>, <span class="number">401</span>]) <span class="comment"># W 被初始化为 hiddemDimX1 的符合正态分布的随机矩阵</span></div><div class="line">b3 = bias_variable([<span class="number">1</span>,<span class="number">401</span>])</div><div class="line"></div><div class="line">hidden = tf.nn.sigmoid(tf.matmul(W, x) + b)</div><div class="line">y = tf.matmul(W2, hidden) + b2</div><div class="line"></div><div class="line"><span class="comment">#  y = 2*(tf.nn.sigmoid(tf.matmul(x, W3) + b3) - 0.5)</span></div><div class="line"><span class="comment">#  y = tf.matmul(x, W3) + b3</span></div><div class="line"></div><div class="line"><span class="comment"># Minimize the squared errors.</span></div><div class="line">loss = tf.reduce_mean(tf.square(y - yTrain)) <span class="comment"># 以y之间的差的平方的均值为损失函数</span></div><div class="line">step = tf.Variable(<span class="number">0</span>, trainable=<span class="keyword">False</span>)</div><div class="line">rate = tf.train.exponential_decay(<span class="number">0.15</span>, step, <span class="number">1</span>, <span class="number">0.9999</span>)</div><div class="line">optimizer = tf.train.AdamOptimizer(rate)</div><div class="line">train = optimizer.minimize(loss, global_step=step)</div><div class="line">init = tf.global_variables_initializer()</div><div class="line"></div><div class="line"><span class="comment"># Launch the graph</span></div><div class="line">sess = tf.Session()</div><div class="line">sess.run(init)</div><div class="line"></div><div class="line"><span class="keyword">for</span> time <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">10001</span>):</div><div class="line">    train.run(&#123;x: xTrain&#125;, sess)</div><div class="line">    <span class="keyword">if</span> time % <span class="number">1000</span> == <span class="number">0</span>:</div><div class="line">        print(<span class="string">'训练次数：'</span>, time, <span class="string">'，训练平均损失值：'</span>, loss.eval(&#123;x: xTrain&#125;, sess))</div><div class="line"></div><div class="line">        plt.clf()</div><div class="line">        plt.plot(xTrain[<span class="number">0</span>], yTrain[<span class="number">0</span>], <span class="string">'ro'</span>, label=<span class="string">u'训练数据'</span>)</div><div class="line">        plt.plot(xTrain[<span class="number">0</span>], y.eval(&#123;x: xTrain&#125;, sess)[<span class="number">0</span>], label = <span class="string">u'拟合曲线'</span>) <span class="comment"># 将训练数据用圆点的形式显示出来</span></div><div class="line">        plt.legend()</div><div class="line">        plt.savefig(<span class="string">'curve_fitting_'</span> + str(int(time/<span class="number">1000</span>)) + <span class="string">'.png'</span>,dpi=<span class="number">200</span>)</div><div class="line"></div><div class="line"><span class="comment"># 在坐标图上，显示最终训练的结果</span></div><div class="line"></div><div class="line">xTest = np.linspace(<span class="number">-40</span>, <span class="number">40</span>, <span class="number">401</span>).reshape([<span class="number">1</span>, <span class="number">-1</span>])</div><div class="line">yTest = computeYByX(xTest)</div><div class="line"></div><div class="line"><span class="comment"># 在坐标图上，显示最终训练的结果</span></div><div class="line">plt.clf()</div><div class="line">plt.plot(xTest[<span class="number">0</span>], yTest[<span class="number">0</span>], <span class="string">'mo'</span>, label=<span class="string">u'测试数据'</span>)</div><div class="line">plt.plot(xTest[<span class="number">0</span>], y.eval(&#123;x: xTest&#125;, sess)[<span class="number">0</span>], label = <span class="string">u'拟合曲线'</span>) <span class="comment"># 将训练数据用圆点的形式显示出来</span></div><div class="line">plt.legend()</div><div class="line">plt.savefig(<span class="string">'curve_fitting_test.png'</span>,dpi=<span class="number">200</span>)</div><div class="line">plt.show() <span class="comment"># 将曲线学习结果用图片直观的显示出来</span></div></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>谢谢，您的支持是我过坑的动力！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="iwifigame 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="iwifigame 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    iwifigame
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://iwifigame.com/tensorflow_curve_fitting/" title="TensorFlow (五) 曲线拟合">http://iwifigame.com/tensorflow_curve_fitting/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/TensorFlow/" rel="tag"># TensorFlow</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/algorithms_bubble_sort/" rel="next" title="算法 (一) 你真的懂冒泡吗">
                <i class="fa fa-chevron-left"></i> 算法 (一) 你真的懂冒泡吗
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/linux_install_summary/" rel="prev" title="Linux 安装过程总结">
                Linux 安装过程总结 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zMDY5OC83MjUz"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="/images/avatar.png"
              alt="iwifigame" />
          
            <p class="site-author-name" itemprop="name">iwifigame</p>
            <p class="site-description motion-element" itemprop="description"></p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-曲线拟合原理"><span class="nav-text">1. 曲线拟合原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-代码详解"><span class="nav-text">2. 代码详解</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-数据生成"><span class="nav-text">2.1 数据生成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-数据表示"><span class="nav-text">2.2 数据表示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-曲线模拟形式选择"><span class="nav-text">2.3 曲线模拟形式选择</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-损失与优化"><span class="nav-text">2.4 损失与优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-训练"><span class="nav-text">2.5 训练</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-测试训练结果"><span class="nav-text">2.6 测试训练结果</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-运行过程与结果"><span class="nav-text">3. 运行过程与结果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-详细代码"><span class="nav-text">4. 详细代码</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">iwifigame</span>

  
</div>

<!-- ����ʾhexo ��ע

  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.2</div>

-->

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  








  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("Ju0g9TyWNmr28UUi493xOsxG-gzGzoHsz", "p5CLocEvdKWa1SAXkH9Lcd68");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

  

</body>
</html>
